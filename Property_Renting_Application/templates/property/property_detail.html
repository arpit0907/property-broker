{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}
{% block content %}


  <div class="container">        
            <h2>Details</h2>
          <table class="table table-striped">
            <thead>
              <tr>
                <th></th>
                <th>Name</th>
                <th>City</th>
                <th>Address</th>
                <th>Size</th>
                <th>Prize</th>
                <th>Created by</th>
              </tr>
            </thead>
            <tbody>
                {% if request.user.profile.roles == "Owner" %}

                   
            <tr>
                   <td> {% if object.property_img  %}
                   <a href="{% url 'property:property-detail' object.id %}">
                   <img src="{{ object.property_img.url }}" width="400" height="200">
                   </a>
                   {% endif %}</td>
                   <td>{{ object.name }}</td>
                   <td>{{ object.city }}</td>
                   <td> {{ object.address }}</td>
                   <td>{{ object.size }}</td>
                   <td> {{ object.prize }}</td>
                   <td>{{ object.created_by }}</td>
                   

                  </tr>
               
                {% else %}
                
            <tr>
                   <td> {% if object.property_img  %}
                   <a href="{% url 'property:property-detail' object.id %}">
                   <img src="{{ object.property_img.url }}" width="400" height="200">
                   </a>
                   {% endif %}</td>
                   <td>{{ object.name }}</td>
                   <td>{{ object.city }}</td>
                   <td> {{ object.address }}</td>
                   <td>{{ object.size }}</td>
                   <td> {{ object.prize }}</td>
                   <td>{{ object.created_by }}</td>
                   <td><button type="button" id="intrested_renter" data-id="{{property.id}}" data-user_id="{{request.user.id}}" data-url="{% url 'property:property-renter-intreted' %}" >Apply</button></td>
                  </tr>

                {%endif%}
            </tbody>
          </table>
        </div>


{% endblock %}


 {% block script %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

<script type="text/javascript">

$(document).ready( function() { 

       $("#intrested_renter").on('click',function(e){
        e.preventDefault();
        
        
        var url = $(this).data('url');
        var property_id = $(this).data('id');
        var user_id = $(this).data('user_id');

        $.ajax({
        type: "POST",
        url: url,
        headers:{
            "X-CSRFToken": '{{csrf_token}}' 
        },
        dataType: "json",
        data: {"property_id":property_id,"user_id":user_id},
        success: function(response) {
                if(response.created == true){
                   alert('Successfully applied')

                }else{
                    alert('already applied')
                }

         }
        });
    });
});

</script>

{% endblock %}
